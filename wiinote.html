<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiinote</title>
    <style>
        html {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            margin: 0;
        }

        #cover {
            position: fixed;
            z-index: 2;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #cover > p {
            font-size: 32px;
        }

        h1 {
            margin: 20px;
        }

        #notebar, #notebar-colors {
            position: absolute;    
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100vh;
        }

        #notebar {
            z-index: 1;
        }

        #notebar-colors {
            border-left: 2px solid black;
            border-right: 2px solid black;
            display: flex;
            flex-direction: column;
        }

        #notebar-colors > div {
            flex: 1;
            background-color: dodgerblue;
        }
    </style>
</head>

<body>
    <div id="cover">
        <p>Click to start the page.</p>
    </div>
    <h1>Wiinote</h1>
    <div id="notebar"></div>
    <div id="notebar-colors"></div>
    <script>
        const BASE_OCTAVE = 5;
        const C_FREQUENCIES = [
            16.35,    // C0
            32.70,    // C1
            65.41,    // C2
            130.81,   // C3
            261.63,   // C4 (Middle C)
            523.25,   // C5
            1046.50,  // C6
            2093.00,  // C7
            4186.01   // C8
        ];
        const B_FREQUENCIES = [
            30.87,    // B0
            61.74,    // B1
            123.47,   // B2
            246.94,   // B3
            493.88,   // B4
            987.77,   // B5
            1975.53,  // B6
            3951.07,  // B7
            7902.13   // B8
        ];
        const BASE_FREQ_INDEX = 5;
        /**
         * 
         * @param {number} base The base frequency.
         * @param {number} semitone The number of semitones, or half notes, above the base octave.
         * @returns The note frequency.
         */
        function getFrequency(base, semitone) {
            const semitoneRatio = Math.pow(2, 1 / 12);
            return base * Math.pow(semitoneRatio, semitone);
        }

        const cover = document.getElementById('cover');
        cover.addEventListener('click', (e) => {
            cover.style.display = 'none';
        });

        for (let i = 0; i < 12; i++) {
            const div = document.createElement('div');
            div.setAttribute("data-semitone", `${11 - i}`);
            document.getElementById("notebar-colors").append(div);
            div.style.opacity = (i / 12);
        };

        const notebar = document.getElementById('notebar');

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        let oscillator;

        function startOscillator() {
            oscillator = audioContext.createOscillator();
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4 note
            oscillator.type = 'sine'; // sine wave
            oscillator.connect(audioContext.destination);
            oscillator.start();
        }
        
        /**
         * 
         * @param {number} newFrequency
         */
        function updateFrequency(newFrequency) {
            oscillator.frequency.setValueAtTime(newFrequency, audioContext.currentTime);
        }

        notebar.addEventListener('mousemove', (e) => {
            if (oscillator == null)
                startOscillator();    
            const semitone = ((1 - (e.clientY / e.target.clientHeight)) * 12) - 0.5;
            const freq = getFrequency(C_FREQUENCIES[BASE_FREQ_INDEX], semitone);
            updateFrequency(freq);
        });

        notebar.addEventListener('mouseout', (e) => {
            oscillator.stop();
            oscillator.disconnect();
            oscillator = null;
        });
    </script>
</body>

</html>